<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RuHub Platform</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>

    <div class="background-anim">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <% if (status === 'allowed') { %>
        <div class="dashboard">
            
            <div id="overlay" class="overlay"></div>

            <aside id="sidebar" class="sidebar">
                <div class="sidebar-logo">
                    RuHub <span style="color: var(--primary)">.PRO</span>
                </div>
                
                <nav class="sidebar-nav">
                    <div class="nav-label">МЕНЮ</div>
                    
                    <a href="/" class="menu-item <%= currentPage === 'home' ? 'active' : '' %>">
                        <i data-feather="grid"></i> Главная
                    </a>
                    
                    <div class="nav-label">РАЗДЕЛЫ</div>
                    
                    <a href="/section/Dota2" class="menu-item <%= currentPage === 'Dota2' ? 'active' : '' %>">
                        <i data-feather="shield"></i> Dota 2
                    </a>
                    <a href="/section/CS2" class="menu-item <%= currentPage === 'CS2' ? 'active' : '' %>">
                        <i data-feather="crosshair"></i> CS2
                    </a>
                    <a href="/section/IRL" class="menu-item <%= currentPage === 'IRL' ? 'active' : '' %>">
                        <i data-feather="coffee"></i> IRL / Chatting
                    </a>

                    <div class="nav-label">ИНСТРУМЕНТЫ</div>
                    <a href="/upload" class="menu-item">
                        <i data-feather="upload-cloud"></i> Загрузить видео
                    </a>
                </nav>

                <div class="sidebar-footer">
                    <p>ID: <%= user.id %></p>
                </div>
            </aside>

            <main class="main-content">
                
                <header class="top-bar">
                    <div class="left-section">
                        <button id="sidebar-toggle" class="icon-btn">
                            <i data-feather="menu"></i>
                        </button>
                        <span class="page-title">
                            <%= currentPage === 'home' ? 'Все видео' : currentPage %>
                        </span>
                    </div>

                    <div class="right-section">
                        <div id="profile-btn" class="profile-widget">
                            <img src="<%= user.photo || 'https://vk.com/images/camera_200.png' %>" class="avatar" alt="User">
                            <i data-feather="chevron-down" style="width: 16px; color: #94a3b8;"></i>
                            
                            <div id="profile-dropdown" class="dropdown-menu">
                                <div class="dropdown-header">
                                    <%= user.firstName %> <%= user.lastName %>
                                </div>
                                <button id="logout-btn" class="dropdown-item logout">
                                    <i data-feather="log-out"></i> Выйти
                                </button>
                            </div>
                        </div>
                    </div>
                </header>

                <div class="video-feed">
                    <% if (videos && videos.length > 0) { %>
                        <% videos.forEach(function(video) { %>
                            <a href="/video/<%= video.slug %>" class="video-card">
                                <div class="preview-container">
                                    <img src="<%= video.preview_url %>" loading="lazy" alt="preview">
                                    <div class="play-overlay"><i data-feather="play" style="width: 48px; height: 48px; color: white;"></i></div>
                                    <div class="category-badge"><%= video.category %></div>
                                </div>
                                <div class="video-info">
                                    <h3 class="video-title"><%= video.title %></h3>
                                    <div class="video-meta">
                                        <span><%= video.views %> просмотров</span> • 
                                        <span><%= new Date(video.created_at).toLocaleDateString() %></span>
                                    </div>
                                </div>
                            </a>
                        <% }); %>
                    <% } else { %>
                        <div style="grid-column: 1 / -1; text-align: center; padding: 60px; color: #94a3b8;">
                            <i data-feather="film" style="width: 48px; height: 48px; opacity: 0.5;"></i>
                            <h3>Здесь пока пусто</h3>
                            <p>Будьте первым, кто загрузит видео!</p>
                        </div>
                    <% } %>
                </div>

                <footer class="site-footer">
                    <div class="footer-content">
                        <div class="footer-branding">
                            <div class="footer-logo">RuHub<span style="color: var(--primary)">.PRO</span></div>
                            <div class="copyright">&copy; 2026 RuHub Media. Все права защищены.</div>
                        </div>
                        <div class="footer-links">
                            <a href="/">Главная</a>
                            <a href="/upload">Загрузить</a>
                            <a href="/privacy">Политика</a>
                            <a href="/terms">Оферта</a>
                        </div>
                    </div>
                </footer>

            </main>
        </div>

    <% } else { %>
        <div class="auth-container">
            <div class="auth-card">
                <div style="font-size: 32px; font-weight: 800; margin-bottom: 10px; color: white;">
                    RuHub<span style="color:var(--primary)">.ID</span>
                </div>
                <h2 style="color: white; margin-bottom: 30px;">Вход в систему</h2>

                <div id="vk-button-container" style="min-height: 44px;"></div>
                <div id="loader" class="loader hidden"></div>
            </div>
        </div>
        <script src="https://unpkg.com/@vkid/sdk@<3.0.0/dist-sdk/umd/index.js"></script>
    <% } %>

    <script src="/js/client.js"></script>
    <script>feather.replace()</script>
</body>
</html>